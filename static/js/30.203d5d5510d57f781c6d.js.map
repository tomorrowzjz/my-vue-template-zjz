{"version":3,"sources":["webpack:///src/pagers/imageEditor.vue","webpack:///./src/pagers/imageEditor.vue?a735","webpack:///./src/pagers/imageEditor.vue"],"names":["imageEditor","data","showImg","imgType","pointX","pointY","canvasStyle","methods","selectImage","event","_this","this","file","currentTarget","files","reader","FileReader","onload","evt","$refs","img","src","target","result","imgDOM","$nextTick","myImg","Image","canvas","width","offsetWidth","height","offsetHeight","getContext","drawImage","readAsDataURL","mousedownEvent","offsetX","offsetY","mouseupEvent","_this2","document","createElement","ctx","imgData","getImageData","x","y","w","h","putImageData","mousemoveEvent","top","right","bottom","left","style","clip","pagers_imageEditor","render","_vm","_h","$createElement","_c","_self","attrs","type","on","change","$event","_v","staticClass","ref","mouseup","mousedown","mousemove","_e","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/30.203d5d5510d57f781c6d.js","sourcesContent":["<template>\r\n    <div>\r\n        <input type=\"file\"  @change=\"selectImage($event)\">\r\n        <div class=\"canvasDiv\" v-if=\"showImg\">\r\n            <!--img背后的canvas-->\r\n            <canvas ref=\"canvas\" class=\"canvas\"></canvas>\r\n            <!--裁剪时候的背景-->\r\n            <div class=\"bg\" @mouseup=\"mouseupEvent($event)\"></div>\r\n            <!--需要裁剪的图片-->\r\n            <img ref=\"img\" class=\"img\">\r\n            <!--裁剪图片区域内的div，为了通过鼠标拖拽进行生成裁剪区域-->\r\n            <div class=\"mouseDiv\"\r\n                 @mousedown=\"mousedownEvent($event)\"\r\n                 @mouseup=\"mouseupEvent($event)\"\r\n                 @mousemove=\"mousemoveEvent($event)\"\r\n            >\r\n            </div>\r\n\r\n        </div>\r\n\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n  export default {\r\n    data () {\r\n      return {\r\n        showImg:false,\r\n        imgType:false,\r\n        pointX:0,\r\n        pointY:0,\r\n        canvasStyle:{}\r\n      }\r\n    },\r\n    methods:{\r\n      //文件流导出\r\n      selectImage(event){\r\n        //获取input[type=file]\r\n        let file = event.currentTarget;\r\n        if(!file.files || !file.files[0]){\r\n          return;\r\n        }\r\n        this.showImg = true;\r\n        let reader = new FileReader();\r\n        //读取文件流\r\n        reader.onload = (evt)=>{\r\n            /*\r\n             this.$refs.img.src相当于对img节点的src属性操作\r\n             evt.target.result为图片文件装换的base64编码\r\n             */\r\n          this.$refs.img.src = evt.target.result;\r\n          let imgDOM = this.$refs.img;\r\n          //当节点渲染完之后\r\n          this.$nextTick(()=>{\r\n            //通过Image将在图片背后的canvas画出来\r\n            let myImg = new Image();\r\n            myImg.onload = ()=>{\r\n              //这里一点要乘2,否则显示出来的比例不正常,下面的一些代码也是\r\n              this.$refs.canvas.width = imgDOM.offsetWidth * 2;\r\n              this.$refs.canvas.height = imgDOM.offsetHeight * 2;\r\n              //画背后canvas\r\n              this.$refs.canvas.getContext('2d').drawImage(myImg,0,0, imgDOM.offsetWidth * 2 , imgDOM.offsetHeight * 2 ,);\r\n            }\r\n            myImg.src = evt.target.result;\r\n          })\r\n\r\n        }\r\n\r\n        reader.readAsDataURL(file.files[0]);\r\n\r\n      },\r\n      //获取鼠标刚要截取的位置\r\n      mousedownEvent(event){\r\n        this.imgType = true;\r\n        this.pointX = event.offsetX;\r\n        this.pointY = event.offsetY;\r\n\r\n\r\n      },\r\n      //当鼠标松开时候(即形成拖拽区域结束)\r\n      mouseupEvent(event){\r\n        this.imgType = false;\r\n        let canvas = document.createElement('canvas');\r\n        let ctx = canvas.getContext('2d');\r\n        this.$nextTick(()=>{\r\n          //将img被裁剪的x,y,w,h所对应的canvas区域拿出来\r\n          let imgData = this.$refs.canvas.getContext('2d').getImageData(\r\n            this.canvasStyle.x * 2,\r\n            this.canvasStyle.y * 2,\r\n            this.canvasStyle.w * 2,\r\n            this.canvasStyle.h * 2);\r\n          canvas.width = this.canvasStyle.w * 2;\r\n          canvas.height = this.canvasStyle.h * 2;\r\n          //将裁剪的区域给新创建的canvas\r\n          ctx.putImageData(imgData,0,0,0,0, this.canvasStyle.w * 2, this.canvasStyle.h * 2);\r\n          //输出base64\r\n          console.log(canvas.toDataURL(\"image/jpeg\"));\r\n//          window.open(canvas.toDataURL(\"image/jpeg\"));\r\n        })\r\n      },\r\n      //鼠标拖拽(通过一个参数imgType控制，当鼠标按下并移动时候才触发实现拖拽)\r\n      mousemoveEvent(event){\r\n        if(this.imgType){\r\n          //获取鼠标拖动的矩形区域\r\n          let x = event.offsetX;\r\n          let y = event.offsetY;\r\n          let top = y < this.pointY ? y : this.pointY;\r\n          let right = x > this.pointX ? x : this.pointX;\r\n          let bottom = y > this.pointY ? y : this.pointY;\r\n          let left = x < this.pointX ? x : this.pointX;\r\n          this.canvasStyle = {\r\n            x:left,\r\n            y:top,\r\n            w:right - left,\r\n            h:bottom - top,\r\n          }\r\n          //对图片进行裁剪\r\n          this.$refs.img.style.clip = `rect(${top}px,${right}px,${bottom}px,${left}px)`;\r\n        }\r\n      },\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n    .canvasDiv{\r\n        position: fixed;\r\n        width: 500px;\r\n        left: calc(50% - 250px);\r\n        top: 100px;\r\n    }\r\n    .bg{\r\n        position: fixed;\r\n        width: 100%;\r\n        height: 100%;\r\n        background: black;\r\n        opacity: 0.5;\r\n        top: 0;\r\n        left: 0;\r\n        z-index: 2;\r\n    }\r\n    .img{\r\n        position: absolute;\r\n        width: 500px;\r\n        top: 0;\r\n        left:0;\r\n        z-index: 3;\r\n        user-select: none;\r\n    }\r\n    .mouseDiv{\r\n        position: absolute;\r\n        width: 100%;\r\n        height: 100%;\r\n        top: 0;\r\n        left: 0;\r\n        z-index: 10;\r\n    }\r\n    .canvas{\r\n        width: 100%;\r\n    }\r\n\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/pagers/imageEditor.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('input',{attrs:{\"type\":\"file\"},on:{\"change\":function($event){_vm.selectImage($event)}}}),_vm._v(\" \"),(_vm.showImg)?_c('div',{staticClass:\"canvasDiv\"},[_c('canvas',{ref:\"canvas\",staticClass:\"canvas\"}),_vm._v(\" \"),_c('div',{staticClass:\"bg\",on:{\"mouseup\":function($event){_vm.mouseupEvent($event)}}}),_vm._v(\" \"),_c('img',{ref:\"img\",staticClass:\"img\"}),_vm._v(\" \"),_c('div',{staticClass:\"mouseDiv\",on:{\"mousedown\":function($event){_vm.mousedownEvent($event)},\"mouseup\":function($event){_vm.mouseupEvent($event)},\"mousemove\":function($event){_vm.mousemoveEvent($event)}}})]):_vm._e()])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-42344f7d\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pagers/imageEditor.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-42344f7d\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./imageEditor.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./imageEditor.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./imageEditor.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-42344f7d\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./imageEditor.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-42344f7d\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pagers/imageEditor.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}